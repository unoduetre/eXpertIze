\documentclass[a4paper]{article}
%\usepackage{polski}
\input{/home/mateusz/TeX/packages}
\title{Image Processing --- Miniproject 2}
\author{Mateusz Grotek, (Ishan Ganeshan)}
\date{}
\begin{document}
\maketitle
\abstract{Spatial and frequency domain two dimensional image filtering --- Octave implementation }
\tableofcontents
\section{Introduction}
(Some ideas are attributed to Ishan Ganeshan. It's always marked when this situation occurs.)

There were five images given. One of them was an original image. 
Other were changed by applying various types of noise to the original image.
My task was to recognize what type of noise was applied, and to choose the best filter for each image. I had to use the following at least once:
\begin{itemize}
\item Defect analysis based on a histogram.
\item Defect analysis based on the frequency spectrum.
\item Filter design in the frequency domain.
\item An order statistic filter.
\item An adaptive filter or an inverse filter of both.
\end{itemize}
\section{Methods}
For implementing the filters I used Octave. The first task was to identify the defects in the images. This part was done together with Ishan Ganeshan. For each image we compared the following plots:
\begin{itemize}
\item the noisy image
\item the original image
\item the difference of the two images
\item the histogram of the noisy image
\item the histogram of the original image
\item the histogram of the difference between both images
\end{itemize}
As far as the fourth image is concerned I also used the frequency domain plot. With this information I was able to create the filters.
\section{Results}
\subsection{Original image}
The following figure represents the original image and its histogram:
\obraz{1}{The original image}
\obraz{4}{The histogram of the original image}
\subsection{Image 1}
The following figure represents the first image and its histogram:
\obraz{2}{The first image}
\obraz{5}{The histogram of the first image}
The following figure represents the difference between the original image
and the current one. There is also a histogram of the difference.
\obraz{3}{The difference between the first image and the original image}
\obraz{6}{The histogram of the differential image of the first and the original image}
It is easy to spot, that the type of noise in the image
is a random one. The histogram of the difference between the images shows that the type of noise is exponential. For this type of noise I decided to use an adaptive local noise reduction filter. This filter needs a parameter, the variance of the noise. For calculating that I used a formula presented in the lectures (\(\sigma^2=\frac{1}{a^2}\)). As the input data for the formula I used the difference between the noisy and the original image. The following figure represents the filtered image:
\obraz{19}{The first image filtered using an adaptive local noise reduction filter}
{\noindent}The code used:
\begin{lstlisting}
function output_image=adaptive_filter(input_image,gvar)
  global global_variance;
  filter=ones(3,3);
  global_variance=gvar;
  output_image=transform(input_image,filter,@adaptive_transform);
endfunction

function output=adaptive_transform(matrix1, matrix2,y,x)
  global global_variance;
  point=matrix1(2,2);
  output=point-global_variance/var(matrix1(:))*(point-mean(matrix1(:)));
endfunction
\end{lstlisting}
\subsection{Image 2}
The following figure represents the second image and its histogram:
\obraz{7}{The second image}
\obraz{9}{The histogram of the second image}
The following figure represents the difference between the original image
and the current one. There is also a histogram of the difference.
\obraz{8}{The difference between the second image and the original image}
\obraz{10}{The histogram of the differential image of the second and the original image}
In the histogram of the image it is easy to spot, that there are two high peaks for black and white. It means, that the noise is salt and pepper noise. The median filter works very well for this kind of noise. The general idea of using median filter was both mine and Ishan Ganeshan's. The following figure represents the second image filtered by a median filter.
\obraz{20}{The second image filtered using a median filter}
{\noindent}The code used:
\begin{lstlisting}
function output_image=median_filter(input_image)
  filter=ones(3,3);
  output_image=transform(input_image,filter,@median_transform);
endfunction

function output=median_transform(matrix1,matrix2,y,x)
  output=median((matrix1.*matrix2)(:));
endfunction
\end{lstlisting}
\subsection{Image 3}
The following figure represents the third image and its histogram:
\obraz{11}{The third image}
\obraz{13}{The histogram of the third image}
The following figure represents the difference between the original image
and the current one. There is also a histogram of the difference.
\obraz{12}{The difference between the third image and the original image}
\obraz{14}{The histogram of the differential image of the third and the original image}
In this case the situation is similar to the previous one, but there is only one peak for the black colour. It means, that the noise is pepper noise. For this kind of noise the max filter works very well. The general idea of using max filter should be attributed wholly to Ishan Ganeshan. The following figure shows the third image filtered by a max filter.
\obraz{21}{The third image filtered using a max filter}
{\noindent}The code used:
\begin{lstlisting}
function output_image=max_filter(input_image)
  filter=ones(3,3);
  output_image=transform(input_image,filter,@max_transform);
endfunction

function output=max_transform(matrix1,matrix2,y,x)
  output=max((matrix1.*matrix2)(:));
endfunction
\end{lstlisting}
\subsection{Image 4}
The following figure represents the fourth image and its histogram:
\obraz{15}{The fourth image}
\obraz{17}{The histogram of the fourth image}
The following figure represents the difference between the original image
and the current one. There is also a histogram of the difference.
\obraz{16}{The difference between the fourth image and the original image}
\obraz{18}{The histogram of the differential image of the fourth and the original image}
In the picture it it is very easy to see, that the noise has periodic character.
It means, that the best way to filter it is to use frequency domain filtering. The method I used is to convert the image using the fast fourier transform to the frequency domain, find and remove white dots in the frequency domain, and convert it back to the spacial domain using the inverse fourier transform. For finding the white dots I needed to see the frequency domain absolute value plot of the image. The following figures represent the frequency domain plots before and after removing the white dots:
\obraz{22}{The frequency domain absolute value plot of the fourth image before filtering}
\obraz{23}{The frequency domain absolute value plot of the fourth image after filtering}
After transforming it back to the spacial domain I got the following result
\obraz{24}{The fourth image filtered using a frequency domain filter}
{\noindent}The code used:
\begin{lstlisting}
freq1=fftshift(fft2(double(image4)));
freq2=uint8(abs(rescale(freq1,0.01)));
freq3=freq1;
freq3(177:179,335:337)=zeros(3,3);
freq3(335:337,177:179)=zeros(3,3);
freq3(287:289,287:289)=zeros(3,3);
freq3(225:227,225:227)=zeros(3,3);
freq4=uint8(abs(rescale(freq3,0.01)));
freq5=uint8(abs(ifft2(fftshift(freq3))));
\end{lstlisting}
\section{Discussion}
All filters achieved acceptable results. The best result was achieved by the frequency domain filter. With this approach it was possible to get the full control over how the image is modified. Still, this approach is not perfect, and the result needs some further processing. Also there is an important distinction between adaptive and frequency domain filters on the one side, and mean, median, min, max filters on the other side. The first group needs some additional information to work correctly, but with the second one we can simply apply the filter without any knowledge about the image. Adaptive filter is also problematic if we know nothing about the noise in the image. What it means is, that the filters from the second group could be implemented in a way to make them accessible for all kinds of users, for example in popular image editors. For the filters in the first group, to get everything from them, a user needs to have some knowledge.
\end{document}
